<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Pyverilog by PyHDI</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Pyverilog</h1>
          <h2>Python-based Hardware Design Processing Toolkit for Verilog HDL</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/PyHDI/Pyverilog/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/PyHDI/Pyverilog/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/PyHDI/Pyverilog" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="publication" class="anchor" href="#publication" aria-hidden="true"><span class="octicon octicon-link"></span></a>Publication</h1>

<p>If you use Pyverilog in your research, please cite my paper.</p>

<ul>
<li>Shinya Takamaeda-Yamazaki: Pyverilog: A Python-based Hardware Design Processing Toolkit for Verilog HDL, 11th International Symposium on Applied Reconfigurable Computing (ARC 2015) (Poster), Lecture Notes in Computer Science, Vol.9040/2015, pp.451-460, April 2015.
<a href="http://link.springer.com/chapter/10.1007/978-3-319-16214-0_42">Paper</a>
</li>
</ul>

<pre><code>@inproceedings{Takamaeda:2015:ARC:Pyverilog,
title={Pyverilog: A Python-Based Hardware Design Processing Toolkit for Verilog HDL},
author={Takamaeda-Yamazaki, Shinya},
booktitle={Applied Reconfigurable Computing},
month={Apr},
year={2015},
pages={451-460},
volume={9040},
series={Lecture Notes in Computer Science},
publisher={Springer International Publishing},
doi={10.1007/978-3-319-16214-0_42},
url={http://dx.doi.org/10.1007/978-3-319-16214-0_42},
}
</code></pre>

<h1>
<a id="whats-pyverilog" class="anchor" href="#whats-pyverilog" aria-hidden="true"><span class="octicon octicon-link"></span></a>What's Pyverilog?</h1>

<p>Pyverilog is an open-source hardware design processing toolkit for Verilog HDL. All source codes are written in Python.</p>

<p>Pyverilog includes <strong>(1) code parser, (2) dataflow analyzer, (3) control-flow analyzer and (4) code generator</strong>.
You can create your own design analyzer, code translator and code generator of Verilog HDL based on this toolkit.</p>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h1>

<h2>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements</h2>

<ul>
<li>Python: 2.7, 3.4 or later</li>
</ul>

<p>Python3 is recommended.</p>

<ul>
<li>Icarus Verilog: 0.9.7 or later</li>
</ul>

<p>Install on your platform. For exmple, on Ubuntu:</p>

<pre><code>sudo apt-get install iverilog
</code></pre>

<ul>
<li>Jinja2: 2.8 or later</li>
<li>pytest: 2.8.2 or later</li>
<li>pytest-pythonpath: 0.7 or later</li>
</ul>

<p>Install on your python environment by using pip.</p>

<pre><code>pip install jinja2 pytest pytest-pythonpath
</code></pre>

<h2>
<a id="options" class="anchor" href="#options" aria-hidden="true"><span class="octicon octicon-link"></span></a>Options</h2>

<ul>
<li>Graphviz: 2.38.0 or later</li>
<li>Pygraphviz: 1.3.1 or later</li>
</ul>

<p>These softwares are option for graph visualization in dataflow/graphgen.py and controlflow/controlflow_analyzer.py.</p>

<pre><code>sudo apt-get install graphviz
pip install pygraphviz
</code></pre>

<h2>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install</h2>

<p>Install Pyverilog.</p>

<pre><code>python setup.py install
</code></pre>

<h1>
<a id="tools" class="anchor" href="#tools" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tools</h1>

<p>This software includes various tools for Verilog HDL design.</p>

<ul>
<li>vparser: Code parser to generate AST (Abstract Syntax Tree) from source codes of Verilog HDL.</li>
<li>dataflow: Dataflow analyzer with an optimizer to remove redundant expressions and some dataflow handling tools.</li>
<li>controlflow: Control-flow analyzer with condition analyzer that identify when a signal is activated.</li>
<li>ast_code_generator: Verilog HDL code generator from AST.</li>
</ul>

<h1>
<a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting Started</h1>

<p>First, please prepare a Verilog HDL source file as below. The file name is 'test.v'.
This sample design adds the input value internally whtn the enable signal is asserted. Then is outputs its partial value to the LED.</p>

<div class="highlight highlight-source-verilog"><pre><span class="pl-k">module</span> <span class="pl-en">top</span>
  (
   <span class="pl-k">input</span> CLK, 
   <span class="pl-k">input</span> RST,
   <span class="pl-k">input</span> enable,
   <span class="pl-k">input</span> [<span class="pl-c1">31</span>:<span class="pl-c1">0</span>] value,
   <span class="pl-k">output</span> [<span class="pl-c1">7</span>:<span class="pl-c1">0</span>] led
  );
  <span class="pl-k">reg</span> [<span class="pl-c1">31</span>:<span class="pl-c1">0</span>] count;
  <span class="pl-k">reg</span> [<span class="pl-c1">7</span>:<span class="pl-c1">0</span>] state;
  <span class="pl-k">assign</span> led <span class="pl-k">=</span> count[<span class="pl-c1">23</span>:<span class="pl-c1">16</span>];
  <span class="pl-k">always</span> @(<span class="pl-k">posedge</span> CLK) <span class="pl-k">begin</span>
    <span class="pl-k">if</span>(RST) <span class="pl-k">begin</span>
      count <span class="pl-k">&lt;=</span> <span class="pl-c1">0</span>;
      state <span class="pl-k">&lt;=</span> <span class="pl-c1">0</span>;
    <span class="pl-k">end</span> <span class="pl-k">else</span> <span class="pl-k">begin</span>
      <span class="pl-k">if</span>(state <span class="pl-k">==</span> <span class="pl-c1">0</span>) <span class="pl-k">begin</span>
        <span class="pl-k">if</span>(enable) state <span class="pl-k">&lt;=</span> <span class="pl-c1">1</span>;
      <span class="pl-k">end</span> <span class="pl-k">else</span> <span class="pl-k">if</span>(state <span class="pl-k">==</span> <span class="pl-c1">1</span>) <span class="pl-k">begin</span>
        state <span class="pl-k">&lt;=</span> <span class="pl-c1">2</span>;
      <span class="pl-k">end</span> <span class="pl-k">else</span> <span class="pl-k">if</span>(state <span class="pl-k">==</span> <span class="pl-c1">2</span>) <span class="pl-k">begin</span>
        count <span class="pl-k">&lt;=</span> count <span class="pl-k">+</span> value;
        state <span class="pl-k">&lt;=</span> <span class="pl-c1">0</span>;
      <span class="pl-k">end</span>
    <span class="pl-k">end</span>
  <span class="pl-k">end</span>
<span class="pl-k">endmodule</span></pre></div>

<h2>
<a id="code-parser" class="anchor" href="#code-parser" aria-hidden="true"><span class="octicon octicon-link"></span></a>Code parser</h2>

<p>Let's try syntax analysis. Please type the command as below.</p>

<pre><code>python pyverilog/vparser/parser.py test.v
</code></pre>

<p>Then you got the result as below. The result of syntax analysis is displayed.</p>

<pre><code>Source: 
  Description: 
    ModuleDef: top
      Paramlist: 
      Portlist: 
        Ioport: 
          Input: CLK, False
            Width: 
              IntConst: 0
              IntConst: 0
        Ioport: 
          Input: RST, False
            Width: 
              IntConst: 0
              IntConst: 0
        Ioport: 
          Input: enable, False
            Width: 
              IntConst: 0
              IntConst: 0
        Ioport: 
          Input: value, False
            Width: 
              IntConst: 31
              IntConst: 0
        Ioport: 
          Output: led, False
            Width: 
              IntConst: 7
              IntConst: 0
      Decl: 
        Reg: count, False
          Width: 
            IntConst: 31
            IntConst: 0
      Decl: 
        Reg: state, False
          Width: 
            IntConst: 7
            IntConst: 0
      Assign: 
        Lvalue: 
          Identifier: led
        Rvalue: 
          Partselect: 
            Identifier: count
            IntConst: 23
            IntConst: 16
      Always: 
        SensList: 
          Sens: posedge
            Identifier: CLK
        Block: None
          IfStatement: 
            Identifier: RST
            Block: None
              NonblockingSubstitution: 
                Lvalue: 
                  Identifier: count
                Rvalue: 
                  IntConst: 0
              NonblockingSubstitution: 
                Lvalue: 
                  Identifier: state
                Rvalue: 
                  IntConst: 0
            Block: None
              IfStatement: 
                Eq: 
                  Identifier: state
                  IntConst: 0
                Block: None
                  IfStatement: 
                    Identifier: enable
                    NonblockingSubstitution: 
                      Lvalue: 
                        Identifier: state
                      Rvalue: 
                        IntConst: 1
                IfStatement: 
                  Eq: 
                    Identifier: state
                    IntConst: 1
                  Block: None
                    NonblockingSubstitution: 
                      Lvalue: 
                        Identifier: state
                      Rvalue: 
                        IntConst: 2
                  IfStatement: 
                    Eq: 
                      Identifier: state
                      IntConst: 2
                    Block: None
                      NonblockingSubstitution: 
                        Lvalue: 
                          Identifier: count
                        Rvalue: 
                          Plus: 
                            Identifier: count
                            Identifier: value
                      NonblockingSubstitution: 
                        Lvalue: 
                          Identifier: state
                        Rvalue: 
                          IntConst: 0
</code></pre>

<h2>
<a id="dataflow-analyzer" class="anchor" href="#dataflow-analyzer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dataflow analyzer</h2>

<p>Let's try dataflow analysis. Please type the command as below.</p>

<pre><code>python pyverilog/dataflow/dataflow_analyzer.py -t top test.v 
</code></pre>

<p>Then you got the result as below. The result of each signal definition and each signal assignment are displayed.</p>

<pre><code>Directive:
Instance:
(top, 'top')
Term:
(Term name:top.led type:{'Output'} msb:(IntConst 7) lsb:(IntConst 0))
(Term name:top.enable type:{'Input'} msb:(IntConst 0) lsb:(IntConst 0))
(Term name:top.CLK type:{'Input'} msb:(IntConst 0) lsb:(IntConst 0))
(Term name:top.count type:{'Reg'} msb:(IntConst 31) lsb:(IntConst 0))
(Term name:top.state type:{'Reg'} msb:(IntConst 7) lsb:(IntConst 0))
(Term name:top.RST type:{'Input'} msb:(IntConst 0) lsb:(IntConst 0))
(Term name:top.value type:{'Input'} msb:(IntConst 31) lsb:(IntConst 0))
Bind:
(Bind dest:top.count tree:(Branch Cond:(Terminal top.RST) True:(IntConst 0) False:(Branch Cond:(Operator Eq Next:(Terminal top.state),(IntConst 0)) False:(Branch Cond:(Operator Eq Next:(Terminal top.state),(IntConst 1)) False:(Branch Cond:(Operator Eq Next:(Terminal top.state),(IntConst 2)) True:(Operator Plus Next:(Terminal top.count),(Terminal top.value)))))))
(Bind dest:top.state tree:(Branch Cond:(Terminal top.RST) True:(IntConst 0) False:(Branch Cond:(Operator Eq Next:(Terminal top.state),(IntConst 0)) True:(Branch Cond:(Terminal top.enable) True:(IntConst 1)) False:(Branch Cond:(Operator Eq Next:(Terminal top.state),(IntConst 1)) True:(IntConst 2) False:(Branch Cond:(Operator Eq Next:(Terminal top.state),(IntConst 2)) True:(IntConst 0))))))
(Bind dest:top.led tree:(Partselect Var:(Terminal top.count) MSB:(IntConst 23) LSB:(IntConst 16)))
</code></pre>

<p>Let's view the result of dataflow analysis as a picture file. Now we select 'led' as the target. Please type the command as below. In this example, Graphviz and Pygraphviz are installed.</p>

<pre><code>python pyverilog/dataflow/graphgen.py -t top -s top.led test.v 
</code></pre>

<p>Then you got a png file (out.png). The picture shows that the definition of 'led' is a part-selection of 'count' from 23-bit to 16-bit.</p>

<p><img src="img/out.png" alt="out.png"></p>

<h2>
<a id="control-flow-analyzer" class="anchor" href="#control-flow-analyzer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Control-flow analyzer</h2>

<p>Let's try control-flow analysis. Please type the command as below. In this example, Graphviz and Pygraphviz are installed. If don't use Graphviz, please append "--nograph" option.</p>

<pre><code>python pyverilog/controlflow/controlflow_analyzer.py -t top test.v 
</code></pre>

<p>Then you got the result as below. The result shows that the state machine structure and transition conditions to the next state in the state machine.</p>

<pre><code>FSM signal: top.count, Condition list length: 4
FSM signal: top.state, Condition list length: 5
Condition: (Ulnot, Eq), Inferring transition condition
Condition: (Eq, top.enable), Inferring transition condition
Condition: (Ulnot, Ulnot, Eq), Inferring transition condition
# SIGNAL NAME: top.state
# DELAY CNT: 0
0 --(top_enable&gt;'d0)--&gt; 1
1 --None--&gt; 2
2 --None--&gt; 0
Loop
(0, 1, 2)
</code></pre>

<p>You got also a png file (top_state.png), if you did not append "--nograph". The picture shows that the graphical structure of the state machine.</p>

<p><img src="img/top_state.png" alt="top_state.png"></p>

<h2>
<a id="code-generator" class="anchor" href="#code-generator" aria-hidden="true"><span class="octicon octicon-link"></span></a>Code generator</h2>

<p>Finally, let's try code generation. Please prepare a Python script as below. The file name is 'test.py'.
A Verilog HDL code is represented by using the AST classes defined in 'vparser.ast'.</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> pyverilog.vparser.ast <span class="pl-k">as</span> vast
<span class="pl-k">from</span> pyverilog.ast_code_generator.codegen <span class="pl-k">import</span> ASTCodeGenerator

params <span class="pl-k">=</span> vast.Paramlist(())
clk <span class="pl-k">=</span> vast.Ioport( vast.Input(<span class="pl-s"><span class="pl-pds">'</span>CLK<span class="pl-pds">'</span></span>) )
rst <span class="pl-k">=</span> vast.Ioport( vast.Input(<span class="pl-s"><span class="pl-pds">'</span>RST<span class="pl-pds">'</span></span>) )
width <span class="pl-k">=</span> vast.Width( vast.IntConst(<span class="pl-s"><span class="pl-pds">'</span>7<span class="pl-pds">'</span></span>), vast.IntConst(<span class="pl-s"><span class="pl-pds">'</span>0<span class="pl-pds">'</span></span>) )
led <span class="pl-k">=</span> vast.Ioport( vast.Output(<span class="pl-s"><span class="pl-pds">'</span>led<span class="pl-pds">'</span></span>, <span class="pl-smi">width</span><span class="pl-k">=</span>width) )
ports <span class="pl-k">=</span> vast.Portlist( (clk, rst, led) )
items <span class="pl-k">=</span> ( vast.Assign( vast.Identifier(<span class="pl-s"><span class="pl-pds">'</span>led<span class="pl-pds">'</span></span>), vast.IntConst(<span class="pl-s"><span class="pl-pds">'</span>8<span class="pl-pds">'</span></span>) ) ,)
ast <span class="pl-k">=</span> vast.ModuleDef(<span class="pl-s"><span class="pl-pds">"</span>top<span class="pl-pds">"</span></span>, params, ports, items)

codegen <span class="pl-k">=</span> ASTCodeGenerator()
rslt <span class="pl-k">=</span> codegen.visit(ast)
<span class="pl-k">print</span>(rslt)</pre></div>

<p>Please type the command as below at the same directory with Pyverilog.</p>

<pre><code>python test.py
</code></pre>

<p>Then Verilog HDL code generated from the AST instances is displayed.</p>

<div class="highlight highlight-source-verilog"><pre><span class="pl-k">module</span> <span class="pl-en">top</span>
(
  <span class="pl-k">input</span> CLK,
  <span class="pl-k">input</span> RST,
  <span class="pl-k">output</span> [<span class="pl-c1">7</span>:<span class="pl-c1">0</span>] led
);

  <span class="pl-k">assign</span> led <span class="pl-k">=</span> <span class="pl-c1">8</span>;

<span class="pl-k">endmodule</span></pre></div>

<h1>
<a id="related-project-and-site" class="anchor" href="#related-project-and-site" aria-hidden="true"><span class="octicon octicon-link"></span></a>Related Project and Site</h1>

<p><a href="https://github.com/PyHDI/veriloggen">Veriloggen</a></p>

<ul>
<li>A library for constructing a Verilog HDL source code in Python</li>
</ul>

<p><a href="https://github.com/PyHDI/PyCoRAM">PyCoRAM</a></p>

<ul>
<li>Python-based Portable IP-core Synthesis Framework for FPGA-based Computing</li>
</ul>

<p><a href="https://github.com/shtaxxx/flipSyrup">flipSyrup</a></p>

<ul>
<li>Cycle-Accurate Hardware Simulation Framework on Abstract FPGA Platforms</li>
</ul>

<p><a href="https://github.com/fukatani/Pyverilog_toolbox">Pyverilog_toolbox</a></p>

<ul>
<li>Pyverilog_toolbox is Pyverilog-based verification/design tool, which is developed by Fukatani-san and uses Pyverilog as a fundamental library. Thanks for your contribution!</li>
</ul>

<p><a href="http://shtaxxx.hatenablog.com/entry/2014/01/01/045856">shtaxxx.hatenablog.com</a></p>

<ul>
<li>Blog entry for introduction and examples of Pyverilog (in Japansese)</li>
</ul>

<h1>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h1>

<p>Apache License 2.0
(<a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>)</p>

<p>This software package includes PLY-3.4 in "vparser/ply". The license of PLY is BSD.</p>

<h1>
<a id="copyright-and-contact" class="anchor" href="#copyright-and-contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Copyright and Contact</h1>

<p>Copyright (C) 2013, Shinya Takamaeda-Yamazaki</p>

<p>E-mail: shinya_at_is.naist.jp</p>
        </section>

        <footer>
          Pyverilog is maintained by <a href="https://github.com/PyHDI">PyHDI</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
